(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{158:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return u}));var a=n(3),r=n(8),l=(n(0),n(281)),o={id:"examples_of_textfsm_usage",title:"Examples Of Textfsm Usage",sidebar_label:"Examples Of Textfsm Usage",slug:"examples_of_textfsm_usage",custom_edit_url:null},i={unversionedId:"python/textfsm/examples_of_textfsm_usage",id:"python/textfsm/examples_of_textfsm_usage",isDocsHomePage:!1,title:"Examples Of Textfsm Usage",description:"This section discusses examples of templates and TextFSM usage.",source:"@site/docs/python/textfsm/4_examples_of_textfsm.md",slug:"/python/textfsm/examples_of_textfsm_usage",permalink:"/docs/python/textfsm/examples_of_textfsm_usage",editUrl:null,version:"current",sidebar_label:"Examples Of Textfsm Usage",sidebar:"someSidebar",previous:{title:"State Rules",permalink:"/docs/python/textfsm/state_rules"},next:{title:"Textfsm Cli Table",permalink:"/docs/python/textfsm/textfsm_cli_table"}},s=[{value:"show clock",id:"show-clock",children:[]},{value:"show ip interface brief",id:"show-ip-interface-brief",children:[]},{value:"show cdp neighbors detail",id:"show-cdp-neighbors-detail",children:[{value:"Record",id:"record",children:[]},{value:"Filldown",id:"filldown",children:[]},{value:"Required",id:"required",children:[]}]},{value:"show ip route ospf",id:"show-ip-route-ospf",children:[{value:"List",id:"list",children:[]}]},{value:"show etherchannel summary",id:"show-etherchannel-summary",children:[]}],p={toc:s};function u(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(l.b)("p",null,"This section discusses examples of templates and TextFSM usage."),Object(l.b)("p",null,"Section uses parse_output.py script to process command output by template. It is not tied to a specific template and output: template and command output will be passed as arguments:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"import sys\nimport textfsm\nfrom tabulate import tabulate\n\ntemplate = sys.argv[1]\noutput_file = sys.argv[2]\n\nwith open(template) as f, open(output_file) as output:\n    re_table = textfsm.TextFSM(f)\n    header = re_table.header\n    result = re_table.ParseText(output.read())\n    print(result)\n    print(tabulate(result, headers=header))\n")),Object(l.b)("p",null,"Example of script run:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"$ python parse_output.py template command_output\n")),Object(l.b)("p",null,"Note"),Object(l.b)("p",null,"Module ",Object(l.b)("inlineCode",{parentName:"p"},"tabulate")," is used to output data in tabular form (it must be installed if you want to use this script). A similar output could be received with string formatting but with tabulate it is easier to do."),Object(l.b)("p",null,"Data processing by template is always done in the same way. Therefore, script will be the same only template and data will be different."),Object(l.b)("p",null,"Starting with a simple example we\u2019ll figure out how to use TextFSM."),Object(l.b)("h2",{id:"show-clock"},"show clock"),Object(l.b)("p",null,"The first example is a review of \u201csh clock\u201d command output (output/sh_clock.txt file):"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"15:10:44.867 UTC Sun Nov 13 2016\n")),Object(l.b)("p",null,"First of all, you have to define variables in template:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"at the beginning of each line there must be a keyword Value"),Object(l.b)("li",{parentName:"ul"},"each variable defines column in table"),Object(l.b)("li",{parentName:"ul"},"next word - variable name"),Object(l.b)("li",{parentName:"ul"},"after name, in parentheses - a regex that describes data")),Object(l.b)("p",null,"Definition of variables is as follows:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value Time (..:..:..)\nValue Timezone (\\S+)\nValue WeekDay (\\w+)\nValue Month (\\w+)\nValue MonthDay (\\d+)\nValue Year (\\d+)\n")),Object(l.b)("p",null,"Tips on special symbols:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},".")," - any character"),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"+")," - one or more repetitions of previous character"),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"\\S")," - all characters except whitespace"),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"\\w")," - any letter or number"),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"\\d")," - any number")),Object(l.b)("p",null,"Once variables are defined, an empty line and ",Object(l.b)("inlineCode",{parentName:"p"},"Start")," state must follow, and then the rule follows starting with space and ",Object(l.b)("inlineCode",{parentName:"p"},"^")," symbol (templates/sh_clock.template file):"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value Time (..:..:..)\nValue Timezone (\\S+)\nValue WeekDay (\\w+)\nValue Month (\\w+)\nValue MonthDay (\\d+)\nValue Year (\\d+)\n\nStart\n  ^${Time}.* ${Timezone} ${WeekDay} ${Month} ${MonthDay} ${Year} -> Record\n")),Object(l.b)("p",null,"Because in this case only one line in the output, it is not necessary to write ",Object(l.b)("inlineCode",{parentName:"p"},"Record")," action in template. But it is better to use it in situations where you have to write values and get used to this syntax and not make mistakes when you need to process multiple lines."),Object(l.b)("p",null,"When TextFSM handles output strings it substitutes variable by its values. In the end, rule will look like:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"^(..:..:..).* (\\S+) (\\w+) (\\w+) (\\d+) (\\d+)\n")),Object(l.b)("p",null,"When this regex applies to \u201cshow clock\u201d output, each regex group will have a corresponding value:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"1 group: 15:10:44"),Object(l.b)("li",{parentName:"ul"},"2 group: UTC"),Object(l.b)("li",{parentName:"ul"},"3 group: Sun"),Object(l.b)("li",{parentName:"ul"},"4 group: Nov"),Object(l.b)("li",{parentName:"ul"},"5 group: 13"),Object(l.b)("li",{parentName:"ul"},"6 group: 2016")),Object(l.b)("p",null,"In addition to explicit ",Object(l.b)("inlineCode",{parentName:"p"},"Record")," action which specifies that record should be placed in final table, the ",Object(l.b)("inlineCode",{parentName:"p"},"Next")," rule is also used by default. It specifies that you want to go to the next line of text. Since there is only one line in \u201csh clock\u201d command output, the processing is completed."),Object(l.b)("p",null,"The result of script is:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"$ python parse_output.py templates/sh_clock.template output/sh_clock.txt\nTime      Timezone    WeekDay    Month      MonthDay    Year\n--------  ----------  ---------  -------  ----------  ------\n15:10:44  UTC         Sun        Nov              13    2016\n")),Object(l.b)("h2",{id:"show-ip-interface-brief"},"show ip interface brief"),Object(l.b)("p",null,"In case when you need to process data displayed in columns, TextFSM template is the most convenient."),Object(l.b)("p",null,"Template for \u201cshow ip interface brief\u201d output (templates/sh_ip_int_br.template file):"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value INTF (\\S+)\nValue ADDR (\\S+)\nValue STATUS (up|down|administratively down)\nValue PROTO (up|down)\n\nStart\n  ^${INTF}\\s+${ADDR}\\s+\\w+\\s+\\w+\\s+${STATUS}\\s+${PROTO} -> Record\n")),Object(l.b)("p",null,"In this case, the rule can be written in one line. Output command (output/sh_ip_int_br.txt file):"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"R1#show ip interface brief\nInterface                  IP-Address      OK? Method Status                Protocol\nFastEthernet0/0            15.0.15.1       YES manual up                    up\nFastEthernet0/1            10.0.12.1       YES manual up                    up\nFastEthernet0/2            10.0.13.1       YES manual up                    up\nFastEthernet0/3            unassigned      YES unset  up                    up\nLoopback0                  10.1.1.1        YES manual up                    up\nLoopback100                100.0.0.1       YES manual up                    up\n")),Object(l.b)("p",null,"The result will be:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"$ python parse_output.py templates/sh_ip_int_br.template output/sh_ip_int_br.txt\nINT              ADDR        STATUS    PROTO\n---------------  ----------  --------  -------\nFastEthernet0/0  15.0.15.1   up        up\nFastEthernet0/1  10.0.12.1   up        up\nFastEthernet0/2  10.0.13.1   up        up\nFastEthernet0/3  unassigned  up        up\nLoopback0        10.1.1.1    up        up\nLoopback100      100.0.0.1   up        up\n")),Object(l.b)("h2",{id:"show-cdp-neighbors-detail"},"show cdp neighbors detail"),Object(l.b)("p",null,"Now try to process output of command \u201cshow cdp neighbors detail\u201d. Peculiarity of this command is that the data are not in the same line but in different lines."),Object(l.b)("p",null,"File output/sh_cdp_n_det.txt contains output of \u201cshow cdp neighbors detail\u201d:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"SW1#show cdp neighbors detail\n-------------------------\nDevice ID: SW2\nEntry address(es):\n  IP address: 10.1.1.2\nPlatform: cisco WS-C2960-8TC-L,  Capabilities: Switch IGMP\nInterface: GigabitEthernet1/0/16,  Port ID (outgoing port): GigabitEthernet0/1\nHoldtime : 164 sec\n\nVersion :\nCisco IOS Software, C2960 Software (C2960-LANBASEK9-M), Version 12.2(55)SE9, RELEASE SOFTWARE (fc1)\nTechnical Support: http://www.cisco.com/techsupport\nCopyright (c) 1986-2014 by Cisco Systems, Inc.\nCompiled Mon 03-Mar-14 22:53 by prod_rel_team\n\nadvertisement version: 2\nVTP Management Domain: ''\nNative VLAN: 1\nDuplex: full\nManagement address(es):\n  IP address: 10.1.1.2\n\n-------------------------\nDevice ID: R1\nEntry address(es):\n  IP address: 10.1.1.1\nPlatform: Cisco 3825,  Capabilities: Router Switch IGMP\nInterface: GigabitEthernet1/0/22,  Port ID (outgoing port): GigabitEthernet0/0\nHoldtime : 156 sec\n\nVersion :\nCisco IOS Software, 3800 Software (C3825-ADVENTERPRISEK9-M), Version 12.4(24)T1, RELEASE SOFTWARE (fc3)\nTechnical Support: http://www.cisco.com/techsupport\nCopyright (c) 1986-2009 by Cisco Systems, Inc.\nCompiled Fri 19-Jun-09 18:40 by prod_rel_team\n\nadvertisement version: 2\nVTP Management Domain: ''\nDuplex: full\nManagement address(es):\n\n-------------------------\nDevice ID: R2\nEntry address(es):\n  IP address: 10.2.2.2\nPlatform: Cisco 2911,  Capabilities: Router Switch IGMP\nInterface: GigabitEthernet1/0/21,  Port ID (outgoing port): GigabitEthernet0/0\nHoldtime : 156 sec\n\nVersion :\nCisco IOS Software, 2900 Software (C3825-ADVENTERPRISEK9-M), Version 15.2(2)T1, RELEASE SOFTWARE (fc3)\nTechnical Support: http://www.cisco.com/techsupport\nCopyright (c) 1986-2009 by Cisco Systems, Inc.\nCompiled Fri 19-Jun-09 18:40 by prod_rel_team\n\nadvertisement version: 2\nVTP Management Domain: ''\nDuplex: full\nManagement address(es):\n")),Object(l.b)("p",null,"From command output you need to get such fields:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"LOCAL_HOST - name of device from prompt"),Object(l.b)("li",{parentName:"ul"},"DEST_HOST - neighbor name"),Object(l.b)("li",{parentName:"ul"},"MGMNT_IP - neighbor IP address"),Object(l.b)("li",{parentName:"ul"},"PLATFORM - model of neighbor device"),Object(l.b)("li",{parentName:"ul"},"LOCAL_PORT - local interface that connects to a neighbor"),Object(l.b)("li",{parentName:"ul"},"REMOTE_PORT - neighbor port"),Object(l.b)("li",{parentName:"ul"},"IOS_VERSION - neighbor IOS version")),Object(l.b)("p",null,"Template looks like this (templates/sh_cdp_n_det.template file):"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value LOCAL_HOST (\\S+)\nValue DEST_HOST (\\S+)\nValue MGMNT_IP (.*)\nValue PLATFORM (.*)\nValue LOCAL_PORT (.*)\nValue REMOTE_PORT (.*)\nValue IOS_VERSION (\\S+)\n\nStart\n  ^${LOCAL_HOST}[>#].\n  ^Device ID: ${DEST_HOST}\n  ^.*IP address: ${MGMNT_IP}\n  ^Platform: ${PLATFORM},\n  ^Interface: ${LOCAL_PORT},  Port ID \\(outgoing port\\): ${REMOTE_PORT}\n  ^.*Version ${IOS_VERSION},\n")),Object(l.b)("p",null,"The result of script execution:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"$ python parse_output.py templates/sh_cdp_n_det.template output/sh_cdp_n_det.txt\nLOCAL_HOST    DEST_HOST    MGMNT_IP    PLATFORM    LOCAL_PORT             REMOTE_PORT         IOS_VERSION\n------------  -----------  ----------  ----------  ---------------------  ------------------  -------------\nSW1           R2           10.2.2.2    Cisco 2911  GigabitEthernet1/0/21  GigabitEthernet0/0  15.2(2)T1\n")),Object(l.b)("p",null,"Although rules with variables are described in different lines and accordingly work with different lines, TextFSM collects them into one line of the table. That is, variables that are defined at the beginning of template determine the string of resulting table."),Object(l.b)("p",null,"Note that sh_cdp_n_det.txt file has three neighbors, but table has only one neighbor, the last one."),Object(l.b)("h3",{id:"record"},"Record"),Object(l.b)("p",null,"This is because ",Object(l.b)("inlineCode",{parentName:"p"},"Record")," action is not specified in template. And only the last line left in final table."),Object(l.b)("p",null,"Corrected template:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value LOCAL_HOST (\\S+)\nValue DEST_HOST (\\S+)\nValue MGMNT_IP (.*)\nValue PLATFORM (.*)\nValue LOCAL_PORT (.*)\nValue REMOTE_PORT (.*)\nValue IOS_VERSION (\\S+)\n\nStart\n  ^${LOCAL_HOST}[>#].\n  ^Device ID: ${DEST_HOST}\n  ^.*IP address: ${MGMNT_IP}\n  ^Platform: ${PLATFORM},\n  ^Interface: ${LOCAL_PORT},  Port ID \\(outgoing port\\): ${REMOTE_PORT}\n  ^.*Version ${IOS_VERSION}, -> Record\n")),Object(l.b)("p",null,"Now the result is:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"$ python parse_output.py templates/sh_cdp_n_det.template output/sh_cdp_n_det.txt\nLOCAL_HOST    DEST_HOST    MGMNT_IP    PLATFORM              LOCAL_PORT             REMOTE_PORT         IOS_VERSION\n------------  -----------  ----------  --------------------  ---------------------  ------------------  -------------\nSW1           SW2          10.1.1.2    cisco WS-C2960-8TC-L  GigabitEthernet1/0/16  GigabitEthernet0/1  12.2(55)SE9\n              R1           10.1.1.1    Cisco 3825            GigabitEthernet1/0/22  GigabitEthernet0/0  12.4(24)T1\n              R2           10.2.2.2    Cisco 2911            GigabitEthernet1/0/21  GigabitEthernet0/0  15.2(2)T1\n")),Object(l.b)("p",null,"Output from all three devices. But LOCAL_HOST variable is not displayed in every line, only in the first one."),Object(l.b)("h3",{id:"filldown"},"Filldown"),Object(l.b)("p",null,"This is because the prompt from which variable value is taken appears only once. And in order to make it appear in the next lines, use ",Object(l.b)("inlineCode",{parentName:"p"},"Filldown")," action for LOCAL_HOST variable:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value Filldown LOCAL_HOST (\\S+)\nValue DEST_HOST (\\S+)\nValue MGMNT_IP (.*)\nValue PLATFORM (.*)\nValue LOCAL_PORT (.*)\nValue REMOTE_PORT (.*)\nValue IOS_VERSION (\\S+)\n\nStart\n  ^${LOCAL_HOST}[>#].\n  ^Device ID: ${DEST_HOST}\n  ^.*IP address: ${MGMNT_IP}\n  ^Platform: ${PLATFORM},\n  ^Interface: ${LOCAL_PORT},  Port ID \\(outgoing port\\): ${REMOTE_PORT}\n  ^.*Version ${IOS_VERSION}, -> Record\n")),Object(l.b)("p",null,"Now we get this output:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"$ python parse_output.py templates/sh_cdp_n_det.template output/sh_cdp_n_det.txt\nLOCAL_HOST    DEST_HOST    MGMNT_IP    PLATFORM              LOCAL_PORT             REMOTE_PORT         IOS_VERSION\n------------  -----------  ----------  --------------------  ---------------------  ------------------  -------------\nSW1           SW2          10.1.1.2    cisco WS-C2960-8TC-L  GigabitEthernet1/0/16  GigabitEthernet0/1  12.2(55)SE9\nSW1           R1           10.1.1.1    Cisco 3825            GigabitEthernet1/0/22  GigabitEthernet0/0  12.4(24)T1\nSW1           R2           10.2.2.2    Cisco 2911            GigabitEthernet1/0/21  GigabitEthernet0/0  15.2(2)T1\nSW1\n")),Object(l.b)("p",null,"LOCAL_HOST now appears in all three lines. But there was another strange effect - the last line in which only LOCAL_HOST column is filled."),Object(l.b)("h3",{id:"required"},"Required"),Object(l.b)("p",null,"The thing is, all variables we\u2019ve determined are optional. Also, one variable with ",Object(l.b)("inlineCode",{parentName:"p"},"Filldown")," parameter. And to get rid of the last line, you have to make at least one variable mandatory by using ",Object(l.b)("inlineCode",{parentName:"p"},"Required")," option:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value Filldown LOCAL_HOST (\\S+)\nValue Required DEST_HOST (\\S+)\nValue MGMNT_IP (.*)\nValue PLATFORM (.*)\nValue LOCAL_PORT (.*)\nValue REMOTE_PORT (.*)\nValue IOS_VERSION (\\S+)\n\nStart\n  ^${LOCAL_HOST}[>#].\n  ^Device ID: ${DEST_HOST}\n  ^.*IP address: ${MGMNT_IP}\n  ^Platform: ${PLATFORM},\n  ^Interface: ${LOCAL_PORT},  Port ID \\(outgoing port\\): ${REMOTE_PORT}\n  ^.*Version ${IOS_VERSION}, -> Record\n")),Object(l.b)("p",null,"Now we get the correct output:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"$ python parse_output.py templates/sh_cdp_n_det.template output/sh_cdp_n_det.txt\nLOCAL_HOST    DEST_HOST    MGMNT_IP    PLATFORM              LOCAL_PORT             REMOTE_PORT         IOS_VERSION\n------------  -----------  ----------  --------------------  ---------------------  ------------------  -------------\nSW1           SW2          10.1.1.2    cisco WS-C2960-8TC-L  GigabitEthernet1/0/16  GigabitEthernet0/1  12.2(55)SE9\nSW1           R1           10.1.1.1    Cisco 3825            GigabitEthernet1/0/22  GigabitEthernet0/0  12.4(24)T1\nSW1           R2           10.2.2.2    Cisco 2911            GigabitEthernet1/0/21  GigabitEthernet0/0  15.2(2)T1\n")),Object(l.b)("h2",{id:"show-ip-route-ospf"},"show ip route ospf"),Object(l.b)("p",null,"Consider the case where we need to process output of \u201cshow ip route ospf\u201d command and in routing table there are several routes to the same network."),Object(l.b)("p",null,"For routes to the same network, instead of multiple lines where network is repeated, one record will be created in which all available next-hop addresses are in list."),Object(l.b)("p",null,"Example of \u201cshow ip route ospf\u201d output (output/sh_ip_route_ospf.txt file):"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"R1#sh ip route ospf\nCodes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP\n       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area\n       N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2\n       E1 - OSPF external type 1, E2 - OSPF external type 2\n       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2\n       ia - IS-IS inter area, * - candidate default, U - per-user static route\n       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP\n       + - replicated route, % - next hop override\n\nGateway of last resort is not set\n\n      10.0.0.0/8 is variably subnetted, 10 subnets, 2 masks\nO        10.1.1.0/24 [110/20] via 10.0.12.2, 1w2d, Ethernet0/1\nO        10.2.2.0/24 [110/20] via 10.0.13.3, 1w2d, Ethernet0/2\nO        10.3.3.3/32 [110/11] via 10.0.12.2, 1w2d, Ethernet0/1\nO        10.4.4.4/32 [110/11] via 10.0.13.3, 1w2d, Ethernet0/2\n                     [110/11] via 10.0.14.4, 1w2d, Ethernet0/3\nO        10.5.5.5/32 [110/21] via 10.0.13.3, 1w2d, Ethernet0/2\n                     [110/21] via 10.0.12.2, 1w2d, Ethernet0/1\n                     [110/21] via 10.0.14.4, 1w2d, Ethernet0/3\nO        10.6.6.0/24 [110/20] via 10.0.13.3, 1w2d, Ethernet0/2\n")),Object(l.b)("p",null,"For this example we simplify the task and assume that routes can only be OSPF and only with \u201cO\u201d designation (i.e., only intra-zone routes)."),Object(l.b)("p",null,"The first version of template:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value network (\\S+)\nValue mask (\\d+)\nValue distance (\\d+)\nValue metric (\\d+)\nValue nexthop (\\S+)\n\nStart\n  ^O +${network}/${mask}\\s\\[${distance}/${metric}\\]\\svia\\s${nexthop}, -> Record\n")),Object(l.b)("p",null,"The result is:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"network      mask    distance    metric  nexthop\n---------  ------  ----------  --------  ---------\n10.1.1.0       24         110        20  10.0.12.2\n10.2.2.0       24         110        20  10.0.13.3\n10.3.3.3       32         110        11  10.0.12.2\n10.4.4.4       32         110        11  10.0.13.3\n10.5.5.5       32         110        21  10.0.13.3\n10.6.6.0       24         110        20  10.0.13.3\n")),Object(l.b)("p",null,"All right, but we\u2019ve lost path options for routes 10.4.4.4/32 and 10.5.5.5/32. This is logical, because there is no rule that would be appropriate for such a line."),Object(l.b)("p",null,"Add a rule to template for lines with partial entries:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value network (\\S+)\nValue mask (\\d+)\nValue distance (\\d+)\nValue metric (\\d+)\nValue nexthop (\\S+)\n\nStart\n  ^O +${network}/${mask}\\s\\[${distance}/${metric}\\]\\svia\\s${nexthop}, -> Record\n  ^\\s+\\[${distance}/${metric}\\]\\svia\\s${nexthop}, -> Record\n")),Object(l.b)("p",null,"Now the output is:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"network    mask      distance    metric  nexthop\n---------  ------  ----------  --------  ---------\n10.1.1.0   24             110        20  10.0.12.2\n10.2.2.0   24             110        20  10.0.13.3\n10.3.3.3   32             110        11  10.0.12.2\n10.4.4.4   32             110        11  10.0.13.3\n                          110        11  10.0.14.4\n10.5.5.5   32             110        21  10.0.13.3\n                          110        21  10.0.12.2\n                          110        21  10.0.14.4\n10.6.6.0   24             110        20  10.0.13.3\n")),Object(l.b)("p",null,"Partial entries are missing networks and masks, but in previous examples we have already covered Filldown and, if desired, it can be applied here. But for this example we will use another option - List."),Object(l.b)("h3",{id:"list"},"List"),Object(l.b)("p",null,"Use ",Object(l.b)("inlineCode",{parentName:"p"},"List")," option for nexthop variable:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value network (\\S+)\nValue mask (\\d+)\nValue distance (\\d+)\nValue metric (\\d+)\nValue List nexthop (\\S+)\n\nStart\n  ^O +${network}/${mask}\\s\\[${distance}/${metric}\\]\\svia\\s${nexthop}, -> Record\n  ^\\s+\\[${distance}/${metric}\\]\\svia\\s${nexthop}, -> Record\n")),Object(l.b)("p",null,"Now the output is:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"network    mask      distance    metric  nexthop\n---------  ------  ----------  --------  -------------\n10.1.1.0   24             110        20  ['10.0.12.2']\n10.2.2.0   24             110        20  ['10.0.13.3']\n10.3.3.3   32             110        11  ['10.0.12.2']\n10.4.4.4   32             110        11  ['10.0.13.3']\n                          110        11  ['10.0.14.4']\n10.5.5.5   32             110        21  ['10.0.13.3']\n                          110        21  ['10.0.12.2']\n                          110        21  ['10.0.14.4']\n10.6.6.0   24             110        20  ['10.0.13.3']\n")),Object(l.b)("p",null,"Now nexthop column displays a list but so far with one element. When using ",Object(l.b)("inlineCode",{parentName:"p"},"List")," the value is a list, and each match with a regex will add an item to the list. By default, each next match overwrites the previous one. If, for example, leave Record action for full lines only:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value network (\\S+)\nValue mask (\\d+)\nValue distance (\\d+)\nValue metric (\\d+)\nValue List nexthop (\\S+)\n\nStart\n  ^O +${network}/${mask}\\s\\[${distance}/${metric}\\]\\svia\\s${nexthop}, -> Record\n  ^\\s+\\[${distance}/${metric}\\]\\svia\\s${nexthop},\n")),Object(l.b)("p",null,"The result will be:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"network      mask    distance    metric  nexthop\n---------  ------  ----------  --------  ---------------------------------------\n10.1.1.0       24         110        20  ['10.0.12.2']\n10.2.2.0       24         110        20  ['10.0.13.3']\n10.3.3.3       32         110        11  ['10.0.12.2']\n10.4.4.4       32         110        11  ['10.0.13.3']\n10.5.5.5       32         110        21  ['10.0.14.4', '10.0.13.3']\n10.6.6.0       24         110        20  ['10.0.12.2', '10.0.14.4', '10.0.13.3']\n")),Object(l.b)("p",null,"Now the result is not quite correct, address hops are assigned to wrong routes. This happens because writing is done on full route entry, then hops of incomplete route entries are collected in the list (other variables are overwritten) and when the next full route entry appears, the list is written to it."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"O        10.4.4.4/32 [110/11] via 10.0.13.3, 1w2d, Ethernet0/2\n                     [110/11] via 10.0.14.4, 1w2d, Ethernet0/3\nO        10.5.5.5/32 [110/21] via 10.0.13.3, 1w2d, Ethernet0/2\n                     [110/21] via 10.0.12.2, 1w2d, Ethernet0/1\n                     [110/21] via 10.0.14.4, 1w2d, Ethernet0/3\nO        10.6.6.0/24 [110/20] via 10.0.13.3, 1w2d, Ethernet0/2\n")),Object(l.b)("p",null,"In fact, incomplete route entry should really be written when the next full route entry appears, but at the same time they should be written to appropriate route. The following should be done: once full route entry is met, the previous values should be written down and then continue to process the same full route entry to get its information. In TextFSM, you can do this with ",Object(l.b)("inlineCode",{parentName:"p"},"Continue.Record"),":"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"^O -> Continue.Record\n")),Object(l.b)("p",null,"Here, ",Object(l.b)("inlineCode",{parentName:"p"},"Record")," action tells you to write down the current value of variables. Since there are no variables in this rule, what was in the previous values is written."),Object(l.b)("p",null,Object(l.b)("inlineCode",{parentName:"p"},"Continue")," action says to continue working with the current line as if there was no match. So, the next line of template will work. The resulting template (templates/sh_ip_route_ospf.template):"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value network (\\S+)\nValue mask (\\d+)\nValue distance (\\d+)\nValue metric (\\d+)\nValue List nexthop (\\S+)\n\nStart\n  ^O -> Continue.Record\n  ^O +${network}/${mask}\\s\\[${distance}/${metric}\\]\\svia\\s${nexthop},\n  ^\\s+\\[${distance}/${metric}\\]\\svia\\s${nexthop},\n")),Object(l.b)("p",null,"The result is:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"network      mask    distance    metric  nexthop\n---------  ------  ----------  --------  ---------------------------------------\n10.1.1.0       24         110        20  ['10.0.12.2']\n10.2.2.0       24         110        20  ['10.0.13.3']\n10.3.3.3       32         110        11  ['10.0.12.2']\n10.4.4.4       32         110        11  ['10.0.13.3', '10.0.14.4']\n10.5.5.5       32         110        21  ['10.0.13.3', '10.0.12.2', '10.0.14.4']\n10.6.6.0       24         110        20  ['10.0.13.3']\n")),Object(l.b)("h2",{id:"show-etherchannel-summary"},"show etherchannel summary"),Object(l.b)("p",null,"TextFSM is convenient to use to parse output that is displayed by columns or to process output that is in different lines. Templates are less convenient when it is necessary to get several identical elements from one line."),Object(l.b)("p",null,"Example of \u201cshow etherchannel summary\u201d output (output/sh_etherchannel_summary.txt file):"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"sw1# sh etherchannel summary\nFlags:  D - down        P - bundled in port-channel\n        I - stand-alone s - suspended\n        H - Hot-standby (LACP only)\n        R - Layer3      S - Layer2\n        U - in use      f - failed to allocate aggregator\n\n        M - not in use, minimum links not met\n        u - unsuitable for bundling\n        w - waiting to be aggregated\n        d - default port\n\n\nNumber of channel-groups in use: 2\nNumber of aggregators:           2\n\nGroup  Port-channel  Protocol    Ports\n------+-------------+-----------+-----------------------------------------------\n1      Po1(SU)         LACP      Fa0/1(P)   Fa0/2(P)   Fa0/3(P)\n3      Po3(SU)          -        Fa0/11(P)   Fa0/12(P)   Fa0/13(P)   Fa0/14(P)\n")),Object(l.b)("p",null,"In this case, it is necessary to get:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"port-channel name and number. For example, Po1"),Object(l.b)("li",{parentName:"ul"},"list of all the ports in it. For example, ",Object(l.b)("inlineCode",{parentName:"li"},"['Fa0/1', 'Fa0/2', 'Fa0/3']"))),Object(l.b)("p",null,"The difficulty is that ports are in the same line and TextFSM cannot specify the same variable multiple times in line. But it is possible to search multiple times for a match in a line."),Object(l.b)("p",null,"The first version of template:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value CHANNEL (\\S+)\nValue List MEMBERS (\\w+\\d+\\/\\d+)\n\nStart\n  ^\\d+ +${CHANNEL}\\(\\S+ +[\\w-]+ +[\\w ]+ +${MEMBERS}\\( -> Record\n")),Object(l.b)("p",null,"Template has two variables:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"CHANNEL - name and number of aggregated port"),Object(l.b)("li",{parentName:"ul"},"MEMBERS - list of ports that are included in an aggregated port. List \u2013 type which is specified for this variable.")),Object(l.b)("p",null,"The result is:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"CHANNEL    MEMBERS\n---------  ----------\nPo1        ['Fa0/1']\nPo3        ['Fa0/11']\n")),Object(l.b)("p",null,"So far, only the first port is in output but we need all ports to hit. In this case after match is found, you should continue processing string with ports. That is, use Continue action and describe the following expression."),Object(l.b)("p",null,"The only line in template describes the first port. Add a line that describes the next port."),Object(l.b)("p",null,"The next version of template:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value CHANNEL (\\S+)\nValue List MEMBERS (\\w+\\d+\\/\\d+)\n\nStart\n  ^\\d+ +${CHANNEL}\\(\\S+ +[\\w-]+ +[\\w ]+ +${MEMBERS}\\( -> Continue\n  ^\\d+ +${CHANNEL}\\(\\S+ +[\\w-]+ +[\\w ]+ +\\S+ +${MEMBERS}\\( -> Record\n")),Object(l.b)("p",null,"The second line describes the same expression, but MEMBERS variable is moved to the next port."),Object(l.b)("p",null,"The result is:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"CHANNEL    MEMBERS\n---------  --------------------\nPo1        ['Fa0/1', 'Fa0/2']\nPo3        ['Fa0/11', 'Fa0/12']\n")),Object(l.b)("p",null,"Similarly, lines that describe the third and fourth ports should be written to template. But, because the output can have a different number of ports, you have to move Record rule to separate line so that it is not tied to a specific number of ports in string."),Object(l.b)("p",null,"For example, if Record is located after the line that describes four ports, for a situation with fewer ports in the line the entry will not be executed."),Object(l.b)("p",null,"The resulting template (templates/sh_ether_channelsummary.txt file):"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value CHANNEL (\\S+)\nValue List MEMBERS (\\w+\\d+\\/\\d+)\n\nStart\n  ^\\d+.* -> Continue.Record\n  ^\\d+ +${CHANNEL}\\(\\S+ +[\\w-]+ +[\\w ]+ +\\S+ +${MEMBERS}\\( -> Continue\n  ^\\d+ +${CHANNEL}\\(\\S+ +[\\w-]+ +[\\w ]+ +(\\S+ +){2} +${MEMBERS}\\( -> Continue\n  ^\\d+ +${CHANNEL}\\(\\S+ +[\\w-]+ +[\\w ]+ +(\\S+ +){3} +${MEMBERS}\\( -> Continue\n")),Object(l.b)("p",null,"The result of processing:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"CHANNEL    MEMBERS\n---------  ----------------------------------------\nPo1        ['Fa0/1', 'Fa0/2', 'Fa0/3']\nPo3        ['Fa0/11', 'Fa0/12', 'Fa0/13', 'Fa0/14']\n")),Object(l.b)("p",null,"Now all ports are in output."),Object(l.b)("p",null,"The template assumes a maximum of four ports in line. If there are more ports, add the corresponding lines to template."),Object(l.b)("p",null,"Another version of \u201csh etherchannel summary\u201d output (output/sh_etherchannel_summary2.txt file):"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"sw1# sh etherchannel summary\nFlags:  D - down        P - bundled in port-channel\n        I - stand-alone s - suspended\n        H - Hot-standby (LACP only)\n        R - Layer3      S - Layer2\n        U - in use      f - failed to allocate aggregator\n\n        M - not in use, minimum links not met\n        u - unsuitable for bundling\n        w - waiting to be aggregated\n        d - default port\n\n\nNumber of channel-groups in use: 2\nNumber of aggregators:           2\n\nGroup  Port-channel  Protocol    Ports\n------+-------------+-----------+-----------------------------------------------\n1      Po1(SU)         LACP      Fa0/1(P)   Fa0/2(P)   Fa0/3(P)\n3      Po3(SU)          -        Fa0/11(P)   Fa0/12(P)   Fa0/13(P)   Fa0/14(P)\n                                 Fa0/15(P)   Fa0/16(P)\n")),Object(l.b)("p",null,"In this output a new version appears - lines containing only ports."),Object(l.b)("p",null,"To process this version you should modify template (templates/sh_etherchannel_summary2.txt file):"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Value CHANNEL (\\S+)\nValue List MEMBERS (\\w+\\d+\\/\\d+)\n\nStart\n  ^\\d+.* -> Continue.Record\n  ^\\d+ +${CHANNEL}\\(\\S+ +[\\w-]+ +[\\w ]+ +${MEMBERS}\\( -> Continue\n  ^\\d+ +${CHANNEL}\\(\\S+ +[\\w-]+ +[\\w ]+ +\\S+ +${MEMBERS}\\( -> Continue\n  ^\\d+ +${CHANNEL}\\(\\S+ +[\\w-]+ +[\\w ]+ +(\\S+ +){2} +${MEMBERS}\\( -> Continue\n  ^\\d+ +${CHANNEL}\\(\\S+ +[\\w-]+ +[\\w ]+ +(\\S+ +){3} +${MEMBERS}\\( -> Continue\n  ^ +${MEMBERS} -> Continue\n  ^ +\\S+ +${MEMBERS} -> Continue\n  ^ +(\\S+ +){2} +${MEMBERS} -> Continue\n  ^ +(\\S+ +){3} +${MEMBERS} -> Continue\n")),Object(l.b)("p",null,"The result will be:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"CHANNEL    MEMBERS\n---------  ------------------------------------------------------------\nPo1        ['Fa0/1', 'Fa0/2', 'Fa0/3']\nPo3        ['Fa0/11', 'Fa0/12', 'Fa0/13', 'Fa0/14', 'Fa0/15', 'Fa0/16']\n")),Object(l.b)("p",null,"This concludes our work with TextFSM templates."),Object(l.b)("p",null,"Examples of templates for Cisco and other vendors can be seen in project ",Object(l.b)("a",{parentName:"p",href:"https://github.com/networktocode/ntc-templates/tree/89c57342b47c9990f0708226fb3f268c6b8c1549/templates"},"ntc-ansible"),"."))}u.isMDXComponent=!0},281:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return h}));var a=n(0),r=n.n(a);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=r.a.createContext({}),u=function(e){var t=r.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(n),d=a,h=c["".concat(o,".").concat(d)]||c[d]||b[d]||l;return n?r.a.createElement(h,i(i({ref:t},p),{},{components:n})):r.a.createElement(h,i({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,o=new Array(l);o[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var p=2;p<l;p++)o[p]=n[p];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);